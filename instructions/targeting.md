# Targeting Rules

## Countries (geo)

### Ограниченные страны Facebook

Следующие страны **НЕ должны использоваться** в таргетинге, так как они ограничены Facebook:
- **CU** (Куба)
- **IR** (Иран)
- **RU** (Россия)
- **SD** (Судан)
- **UK** (неверный код, должен быть **GB** для Великобритании)

Эти страны исключены из `tiers.json` и не должны попадать в `targeting.geo_locations.countries`.

**Важно:** Если пользователь указал одну из этих стран, нужно либо исключить её из таргетинга, либо предупредить пользователя.

### Определение географии

1. **Таргетинг на весь тир** (например, "Latam"):
   - В таргетинге используется весь тир из словаря `tiers.json`
   - Все страны тира добавляются в `targeting.geo_locations.countries`
   - В нейминге указывается только тир без перечисления стран

2. **Таргетинг на конкретные страны**:
   - Если указано 5 или менее стран:
     - Определяется тир для этих стран через `tiers.json`
     - Если все страны из одного тира → используется этот тир в нейминге, страны перечисляются в скобках
     - Если страны из разных тиров → перечисляются все страны в скобках, тир определяется по большинству
   - Если указано более 5 стран:
     - Определяются тиры для всех стран через `tiers.json`
     - Если все страны из одного тира → используется этот тир в нейминге, страны перечисляются в скобках
     - Если страны из разных тиров → используется `WW` в нейминге, **все страны перечисляются в скобках**

3. **Словарь `tiers.json`**:
   - Создается на основе `examples/tiers_by_countries.csv`
   - Содержит маппинг тиров на списки стран
   - Используется для определения тира по странам и для таргетинга на весь тир
   - Доступен через утилиту `utils/tier_utils.py` для программного определения тиров

**Примеры:**
- Таргетинг на "Latam" → все страны LatAm из `tiers.json` в таргетинге, нейминг: `AND_LK_Latam_M_21-65_...`
- Страны ["US", "CA"] → тир Tier1, нейминг: `AND_LK_Tier-1(US,CA)_M_21-65_...`
- Страны ["BR", "MX", "AR", "CO", "CL", "PE", "EC"] (7 стран, все LatAm) → тир LatAm, нейминг: `AND_LK_Latam(BR,MX,AR,CO,CL,PE,EC)_M_21-65_...`
- Страны ["US", "CA", "BR", "MX", "AR", "CO", "CL"] (7 стран, разные тиры) → тир WW, нейминг: `AND_LK_WW(US,CA,BR,MX,AR,CO,CL)_M_21-65_...`

## Country exclusions
Необязательное поле.
При наличии:
- исключённые страны НЕ должны попадать в итоговую географию
- значение должно попасть в поле excluded_countries в CSV

## Gender
Men → targeting.men  
Women → targeting.women  
Both → target all

## Age
Любой диапазон, например:
- 18–44
- 25–65+
- 18–65+

## Language
Берётся из `languages.json`.  
Используется и в таргетинге, и в нейминге.

**По умолчанию (если язык не указан):**
- В таргетинге таргетируются **все языки** (target all languages)
- В финальном CSV поле **Locales** остается **пустым** (не заполняется)
- В нейминге используется `_ALL_` (см. `naming.md`)