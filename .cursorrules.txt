# Cursor Rules for FacebookCampaignBuilder

## Core Principles

Cursor must use information in `instructions/` as canonical rules.
Cursor must consider all dictionaries from `dictionares/`.

## Project Structure

- **Instructions**: `/instructions/` — canonical system operation rules
- **Dictionaries**: `/dictionares/` — all reference books and configuration
- **Examples**: `/examples/` — templates and examples
- **Utilities**: `/utils/` — helper functions

## Campaign Creation Workflow

### Facebook Marketing API is used by default (no CSV fallback)

1. **Naming generation** according to rules from `instructions/naming.md`
2. **Show naming to user** with confirmation request
3. **Account selection** (if project has multiple `account_names`):
   - Show list of names from `project.account_names`
   - Map selected name to `account_id` via `accounts.json`
4. **Creation via API**:
   - Campaign → get `campaign_id`
   - Ad Set → get `adset_id`
   - Automatic logging to `logs.csv`
5. **On API errors**:
   - Show error message to user
   - Do not create any CSV files, do not add entry to `logs.csv` if campaign/adset were not created

## Working with Tiers

- **Tiers dictionary**: `dictionares/tiers.json` (created from `examples/tiers_by_countries.csv`)
- **Tier determination**:
  - If tier is specified directly → use specified tier
  - If countries are specified → determine tier via `tiers.json`:
    - All countries from one tier → use that tier
    - More than 5 countries from different tiers → use `WW`
    - 5 or fewer countries from different tiers → tier by majority
- **Targeting entire tier**: all tier countries from `tiers.json` are added to `targeting.geo_locations.countries` or `targeting.geo_locations.country_groups` (depending on tier)
- **Utility**: use `utils/tier_utils.py` for tier determination

## Working with Accounts

- **Accounts dictionary**: `dictionares/accounts.json` — mapping of names to IDs
- **In projects**: `projects.json` contains `account_names` (names, not IDs)
- **When creating campaign**:
  - If one account → use automatically
  - If multiple → show list of names for selection
  - Map name to ID via `accounts.json`

## Parameter Modification

When modifying any parameter via user command ("change geo", "change budget"), Cursor must:

1. Find parameter in corresponding instruction
2. Update it in:
   - naming (regenerate according to rules)
   - campaign settings
   - adset settings
   - targeting (if geo/age/gender/language)

## Logging

- **Automatic**: after successful creation of Campaign and Ad Set via API
- **File**: `logs.csv` with fields: `campaign_name`, `campaign_id`, `adset_id`, `created_at`
- **Utility**: use `utils/logging.py` to add entries

## Important Rules

1. **Naming is always shown to user** before creation
2. **Actual campaign creation via API happens ONLY after user confirmation**
3. **Only API is used by default**, no CSV files are created
4. **Tiers are determined automatically** via `tiers.json` if not specified explicitly
5. **Accounts are selected by names**, ID is obtained from `accounts.json`
6. **All dictionaries are mandatory** — check availability before use

## Reference Books

- `projects.json` — project settings (account_names, application_id, etc.)
- `accounts.json` — mapping of account names to IDs
- `tiers.json` — mapping of tiers to country lists
- `objectives.json` — campaign objectives mapping for API
- `optimization_goals.json` — optimization models mapping
- `bid_strategies.json` — bid strategies mapping
- `event_types.json` — events to types mapping for API
- `events.json` — available events
- `languages.json` — languages for naming
- `locales.json` — mapping of languages to Facebook locale IDs
- `countries.json` — country codes
- `country_groups.json` — country groups for API
- `api_config.json` — API configuration (access_token, api_version)
